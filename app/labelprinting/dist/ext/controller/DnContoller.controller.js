sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/base/security/URLWhitelist","sap/ui/core/message/Message","sap/ui/core/message/MessageType"],function(e,t,n,i,s,o){"use strict";return e.extend("ns.labelprinting.ext.controller.DnContoller",{onChange:function(e){console.log("change triggered");let t="";let n="";let i=e.getSource().getId();let s=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomSubSection::PrintPreview").getVisible();if(i=="ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--printQId"){t=e.getParameter("selectedItem").getProperty("key");if(t==""){this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::Print").setEnabled(false)}else{if(s){this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::Print").setEnabled(true)}else{this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::Print").setEnabled(false)}}}else{n=e.getParameter("selectedItem").getProperty("key");if(n==""){this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::PrintPreview").setEnabled(false)}else{this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::PrintPreview").setEnabled(true)}}},print:function(e){let t=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--printQId").getProperty("selectedKey");let i=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomSubSection::PrintPreview--pdfViewId").getSource();let s=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::FormContainer::ItemDetails::FormElement::DataField::DeliveryDocument::Field-content").getContentDisplay().mProperties.text+this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::FormContainer::ItemDetails::FormElement::DataField::DeliveryDocumentItem::Field-content").getContentDisplay().mProperties.text+".pdf";fetch(i).then(e=>e.blob()).then(i=>{const o=new FileReader;o.onload=function(){const i=o.result;console.log(i);const l=i.split(",")[1];console.log(l);console.log(typeof l);let a=e.getModel();const r="print";const c=a.bindContext(`/${r}(...)`);c.setParameter("pdf",l);c.setParameter("fileName",s);c.setParameter("printQ",t);c.execute().then(function(){const e=c.getBoundContext();var t=e.fetchValue().getResult();n.show(t.value)}).catch(e=>{console.log(e)})};o.readAsDataURL(i)}).catch(e=>{console.error("Error fetching Blob URL:",e)})},printPreview:function(e){let n=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--printQId").getProperty("selectedKey");let s=this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--templateId").getProperty("selectedKey");let o=e.getModel();const l="com.cap.labelprint.dnservice.render";var a=e.getPath();console.log(a);const r=o.bindContext(`${a}/${l}(...)`);r.setParameter("template",s);r.execute().then(function(){const e=r.getBoundContext();var n=e.getProperty("value");n=n.replaceAll("_","/").replaceAll("-","+");const s=atob(n);const o=new Array(s.length);for(let e=0;e<s.length;e++){o[e]=s.charCodeAt(e)}const l=new Uint8Array(o);var a=new Blob([l],{type:"application/pdf"});const c=URL.createObjectURL(a);let g=new t({Source:c,Title:"Outbound Delivery",Height:"1000px"});i.add("blob");this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomSubSection::PrintPreview").setVisible(true);this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomSubSection::PrintPreview--pdfViewId").setModel(g)}.bind(this)).catch(e=>{console.log(e)})},override:{onInit:function(){},routing:{onBeforeBinding:async function(e){this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::PrintPreview").setEnabled(false);this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomSubSection::PrintPreview").setVisible(false);this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::CustomAction::Print").setEnabled(false);var n=e.getModel();const i="getTemplates";const s=n.bindContext(`/${i}(...)`);s.execute().then(function(){const e=s.getBoundContext();var n=e.fetchValue().getResult();let i=new t({value:n.value});this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--templateId").setModel(i)}.bind(this)).catch(e=>{console.log(e)});const o="getPrintQs";const l=n.bindContext(`/${o}(...)`);l.execute().then(function(){const e=l.getBoundContext();var n=e.fetchValue().getResult();let i=new t({value:n.value});this.getView().byId("ns.labelprinting::DnItemsObjectPage--fe::HeaderFacetCustomContainer::RenderTemplate--printQId").setModel(i)}.bind(this)).catch(e=>{console.log(e)})},onAfterBinding:async function(e){}}}})});
//# sourceMappingURL=DnContoller.controller.js.map